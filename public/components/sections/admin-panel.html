<!-- Admin Panel Section - Versão Completa com CSS -->
<section id="admin-panel-section" class="content-section">
    <!-- Header melhorado -->
    <div class="admin-header-improved">
        <div class="admin-title-section">
            <h2><i class="fas fa-users-cog"></i> Administração de Usuários</h2>
            <p>Gerenciar usuários, permissões e configurações do sistema</p>
        </div>
        <div class="admin-indicator">
            <i class="fas fa-shield-alt"></i>
            <span>Área Restrita - Admin</span>
        </div>
    </div>

    <!-- Admin Stats Cards - Grid melhorado -->
    <div class="admin-stats-grid-improved">
        <div class="admin-stat-card users">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-info">
                <h3 id="total-users-count">0</h3>
                <p>Total de Usuários</p>
                <small id="active-users-count">0 ativos</small>
            </div>
        </div>
        <div class="admin-stat-card roles">
            <div class="stat-icon"><i class="fas fa-user-tie"></i></div>
            <div class="stat-info">
                <h3 id="admin-users-count">0</h3>
                <p>Administradores</p>
                <small id="tech-users-count">0 técnicos</small>
            </div>
        </div>
        <div class="admin-stat-card security">
            <div class="stat-icon"><i class="fas fa-lock"></i></div>
            <div class="stat-info">
                <h3 id="locked-users-count">0</h3>
                <p>Contas Bloqueadas</p>
                <small id="inactive-users-count">0 inativas</small>
            </div>
        </div>
        <div class="admin-stat-card activity">
            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
            <div class="stat-info">
                <h3 id="recent-logins-count">0</h3>
                <p>Logins Hoje</p>
                <small id="new-users-count">0 novos esta semana</small>
            </div>
        </div>
    </div>

    <!-- Admin Toolbar - Layout melhorado -->
    <div class="admin-toolbar-improved">
        <div class="toolbar-left">
            <button class="btn btn-primary" id="create-user-btn">
                <i class="fas fa-user-plus"></i> Novo Usuário
            </button>
            <button class="btn btn-secondary" id="bulk-actions-btn" disabled>
                <i class="fas fa-tasks"></i> Ações em Lote
            </button>
            <button class="btn btn-info" id="export-users-btn">
                <i class="fas fa-download"></i> Exportar
            </button>
        </div>
        <div class="toolbar-right">
            <div class="search-group-improved">
                <input type="text" id="admin-search" placeholder="Buscar usuários...">
                <button class="btn-search" id="admin-search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Filters - Layout em card -->
    <div class="admin-filters-card">
        <div class="filters-header">
            <span><i class="fas fa-filter"></i> Filtros</span>
            <button class="toggle-filters" onclick="toggleFilters()">
                <i class="fas fa-chevron-down" id="filter-toggle-icon"></i>
            </button>
        </div>
        <div class="admin-filters" id="admin-filters-content">
            <div class="filter-group">
                <label for="admin-filter-role">Papel:</label>
                <select id="admin-filter-role" class="filter-select">
                    <option value="">Todos</option>
                    <option value="admin">Administrador</option>
                    <option value="technician">Técnico</option>
                    <option value="user">Usuário</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="admin-filter-status">Status:</label>
                <select id="admin-filter-status" class="filter-select">
                    <option value="">Todos</option>
                    <option value="active">Ativo</option>
                    <option value="inactive">Inativo</option>
                    <option value="locked">Bloqueado</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="admin-filter-department">Departamento:</label>
                <select id="admin-filter-department" class="filter-select">
                    <option value="">Todos</option>
                    <option value="Administração">Administração</option>
                    <option value="Financeiro">Financeiro</option>
                    <option value="Vendas">Vendas</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Produção">Produção</option>
                    <option value="TI">Tecnologia da Informação</option>
                    <option value="RH">Recursos Humanos</option>
                </select>
            </div>
            <div class="filter-actions">
                <button class="btn-filter" id="apply-admin-filters">
                    <i class="fas fa-filter"></i> Filtrar
                </button>
                <button class="btn-clear" id="clear-admin-filters">
                    <i class="fas fa-times"></i> Limpar
                </button>
            </div>
        </div>
    </div>

    <!-- Users Table - Wrapper melhorado -->
    <div class="admin-table-wrapper">
        <div class="table-header">
            <h3><i class="fas fa-table"></i> Lista de Usuários</h3>
            <button class="btn-refresh" onclick="location.reload()">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
        <div class="admin-table-container">
            <table class="admin-users-table" id="admin-users-table">
                <thead>
                    <tr>
                        <th class="checkbox-col">
                            <input type="checkbox" id="select-all-users">
                        </th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Papel</th>
                        <th>Departamento</th>
                        <th>Status</th>
                        <th>Último Login</th>
                        <th>Tickets</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="admin-users-tbody">
                    <!-- Users populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination - Layout melhorado -->
    <div class="admin-pagination-wrapper">
        <div class="pagination-info">
            <span>Mostrando usuários</span>
        </div>
        <div class="admin-pagination" id="admin-pagination">
            <!-- Pagination generated by JavaScript -->
        </div>
    </div>
</section>

<!-- Modal Criar/Editar Usuário -->
<div id="user-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="user-modal-title">Criar Novo Usuário</h3>
            <button class="close-modal" id="close-user-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="user-form">
                <input type="hidden" id="user-id" value="">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="user-name">Nome Completo *</label>
                        <input type="text" id="user-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="user-email">Email *</label>
                        <input type="email" id="user-email" name="email" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="user-role">Papel *</label>
                        <select id="user-role" name="role" required>
                            <option value="">Selecione...</option>
                            <option value="admin">Administrador</option>
                            <option value="technician">Técnico</option>
                            <option value="user">Usuário</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="user-department">Departamento *</label>
                        <select id="user-department" name="department" required>
                            <option value="">Selecione...</option>
                            <option value="Administração">Administração</option>
                            <option value="Financeiro">Financeiro</option>
                            <option value="Vendas">Vendas</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Produção">Produção</option>
                            <option value="TI">Tecnologia da Informação</option>
                            <option value="RH">Recursos Humanos</option>
                        </select>
                    </div>
                </div>

                <div class="form-row" id="password-row">
                    <div class="form-group">
                        <label for="user-password">Senha *</label>
                        <input type="password" id="user-password" name="password" minlength="6">
                        <small>Mínimo 6 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="user-active">Status</label>
                        <select id="user-active" name="active">
                            <option value="true">Ativo</option>
                            <option value="false">Inativo</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancel-user-btn">Cancelar</button>
            <button type="submit" class="btn btn-primary" id="save-user-btn" form="user-form">
                <i class="fas fa-save"></i> Salvar
            </button>
        </div>
    </div>
</div>

<!-- Modal Detalhes do Usuário - ADICIONADO -->
<div id="user-details-modal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="user-details-title">Detalhes do Usuário</h3>
            <button class="close-modal" id="close-user-details-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="user-details-content">
                <div class="user-info-section">
                    <h4>Informações Básicas</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Nome:</label>
                            <span id="detail-user-name">-</span>
                        </div>
                        <div class="info-item">
                            <label>Email:</label>
                            <span id="detail-user-email">-</span>
                        </div>
                        <div class="info-item">
                            <label>Papel:</label>
                            <span id="detail-user-role" class="role-badge">-</span>
                        </div>
                        <div class="info-item">
                            <label>Departamento:</label>
                            <span id="detail-user-department">-</span>
                        </div>
                        <div class="info-item">
                            <label>Status:</label>
                            <span id="detail-user-status" class="status-badge">-</span>
                        </div>
                        <div class="info-item">
                            <label>Criado em:</label>
                            <span id="detail-user-created">-</span>
                        </div>
                        <div class="info-item">
                            <label>Último Login:</label>
                            <span id="detail-user-last-login">-</span>
                        </div>
                    </div>
                </div>

                <div class="user-stats-section">
                    <h4>Estatísticas</h4>
                    <div class="stats-grid-small">
                        <div class="stat-item">
                            <div class="stat-number" id="detail-tickets-assigned">0</div>
                            <div class="stat-label">Tickets Atribuídos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="detail-tickets-created">0</div>
                            <div class="stat-label">Tickets Criados</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="detail-tickets-resolved">0</div>
                            <div class="stat-label">Tickets Resolvidos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="detail-efficiency">0%</div>
                            <div class="stat-label">Taxa de Resolução</div>
                        </div>
                    </div>
                </div>

                <div class="user-security-section">
                    <h4>Segurança</h4>
                    <div class="security-info">
                        <div class="security-item">
                            <label>Tentativas de Login:</label>
                            <span id="detail-login-attempts">0</span>
                        </div>
                        <div class="security-item">
                            <label>Status de Bloqueio:</label>
                            <span id="detail-lock-status" class="lock-status">Desbloqueado</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-warning" id="reset-password-btn">
                <i class="fas fa-key"></i> Resetar Senha
            </button>
            <button class="btn btn-info" id="unlock-user-btn" style="display: none;">
                <i class="fas fa-unlock"></i> Desbloquear
            </button>
            <button class="btn btn-primary" id="edit-user-btn">
                <i class="fas fa-edit"></i> Editar
            </button>
            <button class="btn btn-secondary" id="close-details-btn">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal Ações em Lote -->
<div id="bulk-actions-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Ações em Lote</h3>
            <button class="close-modal" id="close-bulk-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="bulk-info">
                <p>Usuários selecionados: <strong id="selected-count">0</strong></p>
            </div>
            <div class="form-group">
                <label for="bulk-action-select">Ação:</label>
                <select id="bulk-action-select" required>
                    <option value="">Selecione uma ação...</option>
                    <option value="activate">Ativar Usuários</option>
                    <option value="deactivate">Desativar Usuários</option>
                    <option value="unlock">Desbloquear Usuários</option>
                </select>
            </div>
            <div class="warning-message" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Esta ação não pode ser desfeita. Confirme sua escolha.</span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancel-bulk-btn">Cancelar</button>
            <button class="btn btn-danger" id="execute-bulk-btn" disabled>
                <i class="fas fa-play"></i> Executar
            </button>
        </div>
    </div>
</div>

<!-- Modal Resetar Senha -->
<div id="reset-password-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Resetar Senha</h3>
            <button class="close-modal" id="close-reset-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="reset-password-form">
                <input type="hidden" id="reset-user-id" value="">
                <div class="form-group">
                    <label for="new-password">Nova Senha *</label>
                    <input type="password" id="new-password" name="new_password" required minlength="6">
                    <small>Mínimo 6 caracteres</small>
                </div>
                <div class="form-group">
                    <label for="confirm-password">Confirmar Senha *</label>
                    <input type="password" id="confirm-password" required minlength="6">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="force-change" checked> 
                        Forçar troca na próxima login
                    </label>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancel-reset-btn">Cancelar</button>
            <button class="btn btn-warning" id="confirm-reset-btn" form="reset-password-form">
                <i class="fas fa-key"></i> Resetar
            </button>
        </div>
    </div>
</div>

<!-- CSS incluído -->
<style>
/* Header melhorado */
.admin-header-improved {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.admin-title-section h2 {
    margin: 0 0 0.5rem 0;
    font-size: 1.8rem;
}

.admin-title-section p {
    margin: 0;
    opacity: 0.9;
}

.admin-indicator {
    background: rgba(255, 255, 255, 0.15);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    backdrop-filter: blur(10px);
}

/* Stats grid melhorado */
.admin-stats-grid-improved {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.admin-stat-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border-left: 4px solid;
}

.admin-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.admin-stat-card.users { border-color: #007bff; }
.admin-stat-card.roles { border-color: #28a745; }
.admin-stat-card.security { border-color: #ffc107; }
.admin-stat-card.activity { border-color: #17a2b8; }

.admin-stat-card .stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    margin-bottom: 1rem;
}

.admin-stat-card.users .stat-icon { background: #007bff; }
.admin-stat-card.roles .stat-icon { background: #28a745; }
.admin-stat-card.security .stat-icon { background: #ffc107; }
.admin-stat-card.activity .stat-icon { background: #17a2b8; }

/* Toolbar melhorado */
.admin-toolbar-improved {
    background: white;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.toolbar-left {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.search-group-improved {
    display: flex;
    align-items: center;
    background: #f8f9fa;
    border-radius: 25px;
    padding: 0.5rem 1rem;
    min-width: 300px;
}

.search-group-improved input {
    border: none;
    background: transparent;
    outline: none;
    flex: 1;
    padding: 0.25rem 0;
}

.btn-search {
    background: #007bff;
    border: none;
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 0.5rem;
    cursor: pointer;
}

/* Filters card */
.admin-filters-card {
    background: white;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.filters-header {
    background: #f8f9fa;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e9ecef;
    cursor: pointer;
}

.toggle-filters {
    background: none;
    border: none;
    cursor: pointer;
    color: #6c757d;
}

.admin-filters {
    padding: 1.5rem;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    align-items: end;
}

.filter-actions {
    display: flex;
    gap: 0.5rem;
}

/* Table wrapper melhorado */
.admin-table-wrapper {
    background: white;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.table-header {
    background: #f8f9fa;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e9ecef;
}

.table-header h3 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-refresh {
    background: #17a2b8;
    border: none;
    color: white;
    padding: 0.5rem;
    border-radius: 6px;
    cursor: pointer;
}

/* Table Container e Table Styles */
.admin-table-container {
    overflow-x: auto;
    max-width: 100%;
}

.admin-users-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

.admin-users-table thead {
    background: #f8f9fa;
    position: sticky;
    top: 0;
    z-index: 1;
}

.admin-users-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: #495057;
    border-bottom: 2px solid #dee2e6;
    white-space: nowrap;
}

.admin-users-table td {
    padding: 1rem;
    border-bottom: 1px solid #e9ecef;
    vertical-align: middle;
}

.admin-users-table tbody tr:hover {
    background: #f8f9fa;
}

.admin-users-table .checkbox-col {
    width: 40px;
    text-align: center;
}

/* Pagination wrapper melhorado */
.admin-pagination-wrapper {
    background: white;
    border-radius: 10px;
    padding: 1rem 1.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

/* Modal Detalhes do Usuário - Estilização Melhorada */
.modal-large {
    max-width: 800px;
    width: 90%;
}

.user-details-content {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.user-info-section h4,
.user-stats-section h4,
.user-security-section h4 {
    margin: 0 0 1rem 0;
    color: #495057;
    font-size: 1.1rem;
    font-weight: 600;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e9ecef;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.info-item label {
    font-size: 0.875rem;
    color: #6c757d;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.info-item span {
    font-size: 1rem;
    color: #212529;
    font-weight: 500;
}

.stats-grid-small {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1.5rem;
}

.stat-item {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
    border: 1px solid #e9ecef;
    transition: all 0.2s ease;
}

.stat-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.stat-item .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #007bff;
    margin-bottom: 0.5rem;
}

.stat-item .stat-label {
    font-size: 0.875rem;
    color: #6c757d;
    font-weight: 500;
}

.security-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.security-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
}

.security-item label {
    font-size: 0.875rem;
    color: #6c757d;
    font-weight: 500;
}

.security-item span {
    font-size: 1rem;
    color: #212529;
    font-weight: 600;
}

.lock-status {
    color: #28a745;
    font-weight: 600;
}

/* Role e Status badges no modal */
.info-item .role-badge {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
}

.info-item .status-badge {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
}

/* Modal Footer melhorado */
.modal-footer {
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
    padding: 1.5rem;
    background: #f8f9fa;
    border-top: 1px solid #dee2e6;
}

/* Responsividade */
@media (max-width: 768px) {
    .admin-header-improved {
        flex-direction: column;
        text-align: center;
    }
    
    .admin-stats-grid-improved {
        grid-template-columns: 1fr;
    }
    
    .admin-toolbar-improved {
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-group-improved {
        min-width: auto;
        width: 100%;
    }
    
    .admin-filters {
        grid-template-columns: 1fr;
    }
    
    .admin-pagination-wrapper {
        flex-direction: column;
    }
    
    .modal-large {
        width: 95%;
        max-width: none;
    }
    
    .info-grid,
    .stats-grid-small,
    .security-info {
        grid-template-columns: 1fr;
    }
    
    .modal-footer {
        flex-direction: column-reverse;
    }
    
    .modal-footer button {
        width: 100%;
    }
}
</style>

<!-- JavaScript -->
<script>
function toggleFilters() {
    const content = document.getElementById('admin-filters-content');
    const icon = document.getElementById('filter-toggle-icon');
    
    if (content.style.display === 'none') {
        content.style.display = 'grid';
        icon.className = 'fas fa-chevron-up';
    } else {
        content.style.display = 'none';
        icon.className = 'fas fa-chevron-down';
    }
}

// Load admin manager module
if (document.getElementById('admin-panel-section')) {
    const script = document.createElement('script');
    script.src = '/js/modules/admin-manager.js';
    script.onload = function() {
        console.log('✅ Admin Panel scripts carregados');
    };
    script.onerror = function() {
        console.error('❌ Erro ao carregar Admin Panel scripts');
    };
    document.head.appendChild(script);
}
</script>