<!DOCTYPE html>
<html>
<head>
    <title>Teste Auth</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <h1>Teste de Autenticação</h1>
    <div id="status">Carregando...</div>
    
    <script>
    console.log('Script iniciado');
    
    // Criar modal de login imediatamente
    function createLoginModal() {
        const modalHTML = `
            <div id="login-modal" style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            ">
                <div style="
                    background: white;
                    padding: 2rem;
                    border-radius: 10px;
                    max-width: 400px;
                    width: 90%;
                ">
                    <h2>Help Desk Login</h2>
                    <form id="login-form">
                        <div style="margin-bottom: 1rem;">
                            <label>Usuário:</label><br>
                            <input type="text" id="username" value="admin" style="width: 100%; padding: 0.5rem;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label>Senha:</label><br>
                            <input type="password" id="password" value="admin123" style="width: 100%; padding: 0.5rem;">
                        </div>
                        <button type="submit" style="width: 100%; padding: 0.75rem; background: #007bff; color: white; border: none;">
                            Entrar
                        </button>
                    </form>
                    <div style="margin-top: 1rem; font-size: 0.8rem;">
                        <strong>Usuários:</strong><br>
                        admin / admin123<br>
                        suporte01 / suporte123<br>
                        user01 / user123
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Setup do formulário
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            console.log('Tentando login:', username);
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: username, 
                        password: password 
                    })
                });
                
                const data = await response.json();
                console.log('Resposta:', data);
                
                if (response.ok) {
                    localStorage.setItem('helpdesk_access_token', data.data.tokens.access_token);
                    localStorage.setItem('helpdesk_refresh_token', data.data.tokens.refresh_token);
                    localStorage.setItem('helpdesk_user', JSON.stringify(data.data.user));
                    
                    alert('Login realizado com sucesso!');
                    window.location.href = '/';
                } else {
                    alert('Erro: ' + data.message);
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro na requisição: ' + error.message);
            }
        });
    }
    
    // Criar modal imediatamente
    createLoginModal();
    
    document.getElementById('status').textContent = 'Modal criado!';
    </script>
</body>
</html>
